language: node_js
addons:
  ssh_known_hosts: bitbucket.org
node_js:
  - 5
os:
  - linux
env:
  - NODE_ENV=staging
  - NODE_ENV=production
cache:
  directories:
    - "node_modules"
before_install:
  - chmod ugo+x ./test/install_chromedriver_travis.sh
  - sudo ./test/install_chromedriver_travis.sh
  - openssl aes-256-cbc -K $encrypted_1688a3f2e0a8_key -iv $encrypted_1688a3f2e0a8_iv
    -in test/monster_rsa.enc -out ~/.ssh/monster_rsa -d
  - chmod 600 ~/.ssh/monster_rsa
  - gem install bundler
install:
  - npm --production=false install
script:
  - npm run build
  - chmod ugo+x ./test.sh
  - ./test.sh
after_success:
  - python node_modules/travis-weigh-in/weigh_in.py dist/onfido.min.js
  - chmod ugo+x ./deploy.sh
  - ./deploy.sh
